<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <script>

        var image = document.querySelector("img");                 //获取到验证码图片
        var canvas = document.createElement('canvas');                        //新建一个canvas
        var ctx = canvas.getContext("2d");                                    //获取2D上下文
        var numbers = [];                                                     //存储数字模板的数组
        canvas.width = image.width;                                           //设置canvas的宽度
        canvas.height = image.height;                                         //设置canvas的高度
        document.body.appendChild(canvas);                                    //将canvas添加进文档
        ctx.drawImage(image, 0, 0);                                           //将验证码绘制到canvas上
        for (var i = 0; i < 4; i++) {

            var pixels = ctx.getImageData(15 * i + 3, 2, 10, 18).data;


            //按照公式获取到每个数字上的像素点
            var ldString = "";                                                //用来存储明暗值的字符串
            for (var j = 0, length = pixels.length; j < length; j += 4) {                 //每次循环取四个值,分别是一个像素点的r,g,b,a值
                ldString = ldString + (+(pixels[j] * 0.3 + pixels[j + 1] * 0.59 + pixels[j + 2] * 0.11 >= 128));     //灰度化+二值化,但我们并没有真正的处理图像
            }
            console.log(ldString);                 //输出存储着明暗值的字符串
        }


        var numbers = [ //模板,依次是0-9十个数字对应的明暗值字符串
            "111111111111111111111111000011011000000111000110001000111000100011100000011110000001111000000111100000011110000001110001000111000110000000111100001111111101111111111111111111011111",
            "111111111111111110111111100011100000001101000000111111100011111100011011100001111111000111111100011110110001111111000111111000111100000000010000000001111111111111111111111101111111",
            "111111111111111111111100000011100000000110111100001111111000111111000101110100011101100011111100111111000011111001111111000111111100000000110000000010111111111111011111111111111111",
            "111111111011111111111110000011110000000111011110001110011000111111000111000000111100000111111110001101111100001111000001010110001100000000111000001111111111111111110101111110111111",
            "111111111111101110111111111000111111000011110000000111001000111001000111001100011001110001001111000100000000000000000000111110001111111000111111000011111111111111111111111111111111",
            "111111111110111111111100000000100000000011001111111100101101100000011010000000111111100001111011000111111100011011100001011110001100000001111000001111111111111011111110111111111111",
            "110111111111111111111111000001111000000011000011101000111110100011101100011000110000000001000001000000011110000000111000000111000110000000111100000111111111111111111111111110111111",
            "111111111111111111111000000000110000000011111111001111111100111111100110111100111111100111111100001111110011111110011111110001111111001111011000111111111111111111111111011111111111",
            "110111111111011011110011000001111000000100000110001100011000110001000111000000111100000011100010000100011100000001111000000111000100000000111000000111111111111111111111111111111111",
            "111111111111111101111111000011110000000010001110001000111100000011100010001110001000000000110000100011111100001111110001011110001100000001111000001111110111111111111111111111111011"
        ];

    </script>

    <script>

        var image = document.querySelector("img");       //如果要用在greasemonkey脚本里,可以把下面的代码放在image的onload事件里
        var canvas = document.createElement('canvas');
        var ctx = canvas.getContext("2d");
        var numbers_1 = [ //模板,依次是0-9十个数字对应的明暗值字符串
            "111111111111111111111111000011011000000111000110001000111000100011100000011110000001111000000111100000011110000001110001000111000110000000111100001111111101111111111111111111011111",
            "111111111111111110111111100011100000001101000000111111100011111100011011100001111111000111111100011110110001111111000111111000111100000000010000000001111111111111111111111101111111",
            "111111111111111111111100000011100000000110111100001111111000111111000101110100011101100011111100111111000011111001111111000111111100000000110000000010111111111111011111111111111111",
            "111111111011111111111110000011110000000111011110001110011000111111000111000000111100000111111110001101111100001111000001010110001100000000111000001111111111111111110101111110111111",
            "111111111111101110111111111000111111000011110000000111001000111001000111001100011001110001001111000100000000000000000000111110001111111000111111000011111111111111111111111111111111",
            "111111111110111111111100000000100000000011001111111100101101100000011010000000111111100001111011000111111100011011100001011110001100000001111000001111111111111011111110111111111111",
            "110111111111111111111111000001111000000011000011101000111110100011101100011000110000000001000001000000011110000000111000000111000110000000111100000111111111111111111111111110111111",
            "111111111111111111111000000000110000000011111111001111111100111111100110111100111111100111111100001111110011111110011111110001111111001111011000111111111111111111111111011111111111",
            "110111111111011011110011000001111000000100000110001100011000110001000111000000111100000011100010000100011100000001111000000111000100000000111000000111111111111111111111111111111111",
            "111111111111111101111111000011110000000010001110001000111100000011100010001110001000000000110000100011111100001111110001011110001100000001111000001111110111111111111111111111111011"
        ];
        var numbers_2 = [ //模板,依次是0-9十个数字对应的明暗值字符串
            "110100001111100000011100011000100011100010001110000001111000000111100000011110000001111000000111000100011100011000000011110000111111111111110111111111111111100111111111111111111111",
            "111110001111000000111100000011111110001111110001111111000110111000011101100001101111000111111100011111100011110000000001000000000111111111111111111111111111011111111111111111111111",
            "110000001110000000011011110000111111100011111000011111110001111110001111110011101100011111100111111100011111110000000011000000001111111111111110111111111111111111111111111111111111",
            "111000001111000000011101111000111111100011111100011100000011110000011111011000111111110001111111000101111000110000000011100000111111111111111111111111111111111111111111101111111110",
            "111111100011110100001111000000111100100011100100011100110001100111000100111100010000000000000000000011110000111111100011111110001111111110111111111011111111111111011111111111111111",
            "110000000011000000001100111111010011110110000001111000000011111010000111111100011111110001111110000101110000110000000011100000111111111111111111111111111111111111111111111111111111",
            "011100000111100000001100001110100011111110001111110001100011000000000100001100000001111000000111100000011100011000000011110000011110111111111111110111111110111111111111111011111111",
            "010000000011000000001111111100111111110001111110011111010011111110011111110001111111001111111001111111000111111100111111100011111111111110111111111111110111111111111111111111111011",
            "111100000111100000011100011000110001100011000100011100000011110000001110001000010001110000000111100000011100010000000011100000011111111111011111111011111111111111111111101111111101",
            "111100001111000000001000111000100011110010001110001000111000100000000011000010001101100000111111000101111000010000000111100000111111101111111111101111111111111111111111110111111111"
        ];

        var captcha = ""; //存放识别后的验证码
        canvas.width = image.width;
        canvas.height = image.height;
        document.body.appendChild(canvas);
        ctx.drawImage(image, 0, 0);
        for (var i = 0; i < 4; i++) {
            var numbers = null;
            if (i % 2 == 0) {
                numbers = numbers_1;
            } else {
                numbers = numbers_2;
            }
            var pixels = ctx.getImageData(15 * i + 3, 2, 10, 18).data;
            var ldString = "";
            for (var j = 0, length = pixels.length; j < length; j += 4) {
                ldString = ldString + (+(pixels[j] * 0.3 + pixels[j + 1] * 0.59 + pixels[j + 2] * 0.11 >= 140));
            }
            var comms = numbers.map(function (value) { //为了100%识别率,这里不能直接判断是否和模板字符串相等,因为可能有个别0被计算成1,或者相反
                return ldString.split("").filter(function (v, index) {
                    return value[index] === v
                }).length
            });
            captcha += comms.indexOf(Math.max.apply(null, comms)); //添加到识别好的验证码中
        }
        console.log(captcha);

    </script>

</head>
<body>

</body>
</html>